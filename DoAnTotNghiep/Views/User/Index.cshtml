@model UserVM
@{
    Layout = "~/Views/Shared/_LayoutUser.cshtml";
}

<div class="container">
    <form name="frmUser" id="frmUser" class="p-4" asp-controller="User" asp-action="Update">
        @Html.AntiForgeryToken()
        <input asp-for="Id" type="hidden" />
        <div class="col-md-6">
            <div class="fileupload fileupload-new" data-provides="fileupload">
                <div class="row">
                    <div class="col-md-12 fileupload-name">
                        <div class="fileupload-new control-label">Ảnh</div>
                        <div class="fileupload-exists control-label">Ảnh</div>
                    </div>
                    <div class="col-md-12 fileupload-img">
                        <span class="button btn-system btn-file btn-block">
                            <label class="btn btn-default btn-file chooseFile p-2">Chọn ảnh</label>
                            <input style="max-width: 45px; max-height: 20px;" type="file" name="Image" id="Image" />
                        </span>
                    </div>
                </div>
                <div class="fileupload-preview thumbnail mb15" id="thumbnailpost">
                    <img style="margin-bottom:14px;" src="@Model.ImageUrl" />
                    <input type="hidden" asp-for="ImageUrl" value="@Model.ImageUrl" />
                </div>
            </div>
        </div>
        <div class="form-group">
            <label for="inputFullname">Họ tên</label>
            <input type="text" class="form-control" asp-for="FullName" placeholder="Nhập họ và tên">
        </div>
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="inputEmail4">Email</label>
                <input type="email" class="form-control" asp-for="Email" readonly placeholder="Email">
            </div>
            <div class="form-group col-md-6">
                <input type="hidden" asp-for="Password">
                <input type="hidden" asp-for="TypeUser">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-6 p-0">
                <label for="inputAddress2">Ngày sinh</label>
                <input type="Date" class="form-control" asp-for="Birthday" placeholder="">
            </div>
            <div class="form-group col-md-6">
                <label for="inputSex">Giới tính</label>
                <select class="form-control" asp-for="Sex">
                    <option value="1">Nam</option>
                    <option value="0">Nữ</option>
                </select>
            </div>
        </div>
        <button type="submit" id="frmUser" class="btn btn-primary">Cập nhật</button>
    </form>
</div>
@section Scripts{
    <script>
        $('body').on('submit', '#frmUser', function () {
            var _self = $(this);
            var _selfForm = new FormData();
            if (document.getElementById("Image").files != null) {
                var totalFiles = document.getElementById("Image").files.length;
                for (var i = 0; i < totalFiles; i++) {
                    var file = document.getElementById("Image").files[i];
                    _selfForm.append("Image", file);
                }
            }
            var arr = _self.serializeArray();
            $.each(arr, function (i, field) {
                _selfForm.append(field.name, field.value);
            });
            $.ajax({
                url: _self.attr('action'),
                data: _selfForm,
                type: 'post',
                contentType: false,
                processData: false,
                async: true,
                success: function (data) {
                    if (data.status) {
                        common.showNotify("Cập nhật thành công", "success");
                    }
                    else {
                        common.showNotify("Cập nhật thất bại", "error");
                    }
                }
            });
            return false;
        });
    </script>
}